# 负载均衡(Nginx+Redis)

### 基础信息

随着互联网使用人数的不断增多，服务器的压力也越来越大。以往只用一台服务器即可满足使用的时代或许早已过去（除去一些轻量级的应用可能只要一个服务器即足够）。目前的应用服务器绝大部分都是采用集群负载均衡的策略，避免请求流量集中到一台服务器上，导致服务器压力过大引发宕机，使得应用无法正常工作。

这些现代服务器集群系统一般都会有一个网关服务器，使用诸如Nginx的应用，将客户端发送的请求通过某种策略分散地转发到集群中的各个服务器上。一般，为了保证请求被均匀地转发，会使用一致性Hash算法将请求发送到hash值对应的服务器上。Nginx中集成了一致性Hash算法，可以通过修改配置文件，实现Cookies一致性Hash。比如我们的系统就是将房间ID放入Cookies中，然后Nginx将根据Cookies中的房间进行一致性Hash，这样就能保证同一房间的始终是在同一个服务器上对战（由于ws的原因，必须保证两个ws连在同一个服务器上，否则还要进行数据的转发，得不偿失）。

### 反向代理

Nginx起到的其实是反向代理的工作。何为反向代理？先从正向代理开始入手了解：其实我们一般进行Http请求的时候就用到了正向代理。一般客户端和服务器之间都会有一个代理，该代理主要负责转发的工作：将客户端的请求转发给服务器，再把服务器的请求转发给客户端。客户端一般是感受不到代理的存在的，就好像客户端就在和服务器直接进行沟通。而服务器无法知道对面的客户端是谁，这就是正向代理。

对于反向代理，首先要明确一个概念，那就是一个域名可以对应多态显示器。比如www.baidu.com这个域名后面指向的是很多很多的服务器。也就是说客户端只知道这个域名，而不知道这个域名后面对应的服务器。客户端只知道这个公网IP，而不知道这个公网IP背后集群中众多服务器的存在，也不知道自己的请求将被发往哪台服务器（内网是对外部不可见的，就像家里面连Wifi，分配给设备的IP都是内网IP）。这就是反向代理。

### Redis共享缓存







